# ClawFlag V5 完整开发计划

> 虾皮自动执行 | 2026-02-22

## 总体目标
按 PRD V5 要求完成 MVGP（最小可行治理产品），包含三大支柱 + 完整前端重构。

## Phase 0（已完成 ✅）
- [x] Relay Server 部署运行
- [x] clawflag-agent 编译通过
- [x] App 前端 Relay 连接模式
- [x] Token 生成/配对 UI
- [x] 安全审计 + Token 轮换

## Phase 1: MVGP 开发任务

### Batch 1: 紧急停止按钮 + 驾驶舱基础
- [ ] 1.1 紧急停止浮动按钮（常驻UI，高优先级独立信道）
- [ ] 1.2 紧急停止后端（clawflag-agent 接收 → Gateway 终止所有任务）
- [ ] 1.3 "探查"按钮（每条Agent回复旁，展开思考链/工具调用树）
- [ ] 1.4 工具调用内联卡片（截图缩略图、文件diff、shell输出折叠）

### Batch 2: 成本熔断器 + 成本顾问
- [ ] 2.1 日累计成本实时监控
- [ ] 2.2 三层熔断器（70%警告 / 90%降级 / 100%暂停）
- [ ] 2.3 成本顾问引擎（模型建议 + 心跳优化 + 异常检测）
- [ ] 2.4 单条消息成本标签

### Batch 3: 对话增强
- [ ] 3.1 危险操作内联批准按钮
- [ ] 3.2 多步骤进度条
- [ ] 3.3 上下文压缩警告条 + 一键压缩
- [ ] 3.4 手动"总结此会话"按钮

### Batch 4: 脉搏页增强
- [ ] 4.1 概览视图（3个数字 + 1句话）
- [ ] 4.2 子Agent DAG 可视化
- [ ] 4.3 上下文窗口计量器
- [ ] 4.4 安全横幅（版本检查 + 暴露检查）

### Batch 5: 大脑页 + 记忆智能
- [ ] 5.1 记忆时间线浏览器（真实数据替换mock）
- [ ] 5.2 语义搜索
- [ ] 5.3 记忆保真度评分环
- [ ] 5.4 配置编辑器 L0-L3 分层

### Batch 6: 路由页 + Gateway安全
- [ ] 6.1 ClawRouter 模型路由文本配置
- [ ] 6.2 备用链配置
- [ ] 6.3 Gateway 安全审计（版本/暴露/认证/技能）
- [ ] 6.4 技能护盾基础版

### Batch 7: 集成测试 + 部署
- [ ] 7.1 E2E 测试全流程
- [ ] 7.2 PWA 离线缓存更新
- [ ] 7.3 部署 Vercel + 铁锤
- [ ] 7.4 README + CHANGELOG 更新
